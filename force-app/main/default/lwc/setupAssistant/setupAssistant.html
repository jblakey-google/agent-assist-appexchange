<template>
    <lightning-card>
        <h3 class="msg-title" slot="title">
            <template lwc:if={error}>
                <lightning-icon class="icon--error" icon-name="utility:error" size="small"></lightning-icon>
            </template>
            <template lwc:elseif={isSuccess}>
                <lightning-icon class="icon--success" icon-name="utility:success" size="small"></lightning-icon>
            </template>
            <template lwc:else>
                <lightning-icon icon-name="standard:custom" size="small"></lightning-icon>
            </template>
            Agent Assist Setup Assistant
        </h3>
        <div class="slds-p-around_medium">
            <template lwc:if={error}>
                <div class="slds-notify slds-notify_alert slds-theme_error slds-m-bottom_medium" role="alert">
                    <span class="slds-assistive-text">error</span>
                    <h2>{error}</h2>
                </div>
                <p class="slds-p-top_small slds-text-color_error">
                    Note: Ensure a Remote Site Setting is added for your org's domain.
                </p>
            </template>

            <template lwc:if={resourcesAreNotDeployed}>
                <p class="slds-m-bottom_small">
                    Click the button below to automatically configure the routing engine and permissions:
                </p>
    
                <ul class="slds-list_dotted slds-m-bottom_medium slds-m-left_medium">
                    <li><strong>Enable Features:</strong> Activates Messaging and Service Cloud Voice settings.</li>
                    <li><strong>Service Channels:</strong> Configures channels for Messaging and Voice.</li>
                    <li><strong>Routing Engine:</strong> Creates the "Agent Assist" Queue and Routing Configuration.</li>
                    <li><strong>Presence Statuses:</strong> Creates "Busy" and "Online (Messaging)" statuses.</li>
                    <li><strong>Permissions:</strong> Generates the "Agent Assist Messaging" Permission Set.</li>
                    <li><strong>User Access:</strong> Automatically assigns the permission set to <strong>you</strong>.</li>
                </ul>
            </template>

            <template lwc:if={tableData}>
                <div class="slds-m-bottom_medium">
                    <p class="slds-text-body_regular slds-m-bottom_medium">
                        Upon clicking the Deploy Metadata Resources button, the setup assistant has automatically configured the core infrastructure required for GCP Agent Assist. You are now viewing a summary of the successfully Deployed resources, which includes the necessary Service Channels, Routing Configurations, and Permission Sets required to handle messaging and voice traffic. Each entry includes a direct link to the specific resource within your Salesforce setup, allowing you to verify configurations or make manual adjustments as needed.
                    </p>
                    <lightning-datatable
                        hide-checkbox-column
                        key-field="name"
                        data={tableData}
                        columns={tableCols}>
                    </lightning-datatable>
                </div>
            </template>

            <template lwc:if={resourcesAreNotDeployed}>
                <lightning-button 
                    variant="brand" 
                    label="Deploy Metadata Resources" 
                    onclick={handleDeploy}
                    disabled={isLoading}>
                </lightning-button>
            </template>

            <template lwc:if={isLoading}>
                <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
            </template>
        </div>
    </lightning-card>
</template>